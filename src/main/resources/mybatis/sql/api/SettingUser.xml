<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kdc.mybatis.mapper.api.SettingUserMapper">
  <update id="updateUserMaster">
        UPDATE
            user_master
        SET
        <if test='regRec.password != null'>
            password = #{regRec.password},
        </if>
        <if test='regRec.username != null'>
            user_name = #{regRec.username},
        </if>
        <if test='regRec.iconid != null'>
            icon_id = #{regRec.iconid},
        </if>
        <if test='regRec.iconfile != null'>
            icon_file = #{regRec.iconfile},
        </if>
        <if test='regRec.groupid != null'>
            group_id = #{regRec.groupid},
        </if>
        <if test='regRec.authlevel != 0 and regRec.authlevel != null'>
            auth_level = #{regRec.authlevel},
        </if>
        <if test='regRec.linecolor != null'>
            line_color = #{regRec.linecolor},
        </if>
        <if test='regRec.markercolor != null'>
            marker_color = #{regRec.markercolor},
        </if>
            update_user_id = #{regRec.updateuserid},
            update_date = #{regRec.updatedate}

        WHERE
            user_id = #{condRec.userid}
        AND del_flg = 0
  </update>

  <select id="selectUserInfo" parameterType="com.kdc.common.entity.db.UserMasterEntity" 
        resultType="Integer" >
        SELECT
            count(*)

        FROM user_master
        
        WHERE
            del_flg = 0
        AND user_name = #{rec.username}
        AND user_id   != #{rec.userid}
  </select>
</mapper>