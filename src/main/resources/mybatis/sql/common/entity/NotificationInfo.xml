<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kdc.mybatis.mapper.common.entity.NotificationInfoMapper">
  <sql id="selectAllColumnsFromNotificationInfo">
        SELECT
            group_id                                        AS  groupId,
            user_id											AS  userId,
            notification_date                               AS  notificationDate,
            notification_time                               AS  notificationTime,
            auth_level                                   	AS  authLevel,
            notification_level                              AS  notificationLevel,
            notification_flg                                AS  notificationFlg,
            message                                   		AS  message,
            del_flg                                         AS  delflg,
            register_user_id                                AS  registeruserid,
            register_date                                   AS  registerdate,
            update_user_id                                  AS  updateuserid,
            update_date                                     AS  updatedate

        FROM
            notification_info
  </sql>

  <select id="selectAll" resultType="com.kdc.common.entity.db.NotificationInfoEntity">
    <include refid="selectAllColumnsFromNotificationInfo"></include>
    <where>
      <if test='delflg != null'>
            del_flg = #{delflg}
      </if>
    </where>
        ORDER BY
            TO_NUMBER(user_id,'00000')
  </select>

  <select id="selectByPk" resultType="com.kdc.common.entity.db.NotificationInfoEntity">
    <include refid="selectAllColumnsFromNotificationInfo"></include>
        WHERE
            user_id = #{userId}
    <if test='delflg != null'>
        AND del_flg = #{delflg}
    </if>
  </select>

  <insert id="insert" parameterType="com.kdc.common.entity.db.NotificationInfoEntity">
        INSERT INTO
            notification_info
        (
            group_id,
            user_id,
            notification_date,
            notification_time,
            auth_level,
            notification_level,
            notification_flg,
            message,
            del_flg,
            register_user_id,
            register_date
        )
        VALUES
        (
            #{rec.groupId},
            #{rec.userId},
            #{rec.notificationDate},
            #{rec.notificationTime},
            #{rec.authLevel},
            #{rec.notificationLevel},
            #{rec.notificationFlg},
            #{rec.message},
            0,
            #{rec.registeruserid},
            #{rec.registerdate}
        )
  </insert>

  <update id="update" parameterType="com.kdc.common.entity.db.NotificationInfoEntity">
        UPDATE
            notification_info
        SET
    <if test='rec.notificationDate != null'>
            notification_date = #{rec.notificationdate},
    </if>
    <if test='rec.notificationTime != null'>
            notification_time = #{rec.notificationTime},
    </if>
    <if test='rec.authLevel != null'>
            auth_level = #{rec.authLevel},
    </if>
    <if test='rec.notificationLevel != null'>
            notification_level = #{rec.notificationLevel},
    </if>
    <if test='rec.notificationFlg != null'>
            notification_flg = #{rec.notificationFlg},
    </if>
    <if test='rec.message != null'>
            message = #{rec.message},
    </if>
            update_user_id = #{rec.updateuserid},
            update_date = #{rec.updatedate}
        WHERE
            group_id = #{rec.groupId}
  </update>
  
  <update id="delete" parameterType="com.kdc.common.entity.db.NotificationInfoEntity">
        UPDATE
            notification_info
        SET
    		del_flg = 1,
            update_user_id = #{rec.updateuserid},
            update_date = #{rec.updatedate}
        WHERE
            user_id = #{rec.userId}
        AND
            notification_date= #{rec.notificationDate}    
  </update>
<!--  ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  <insert id="insertSendIntervalConfig" parameterType="com.kdc.common.entity.db.NotificationInfoEntity">
        INSERT INTO
            send_interval_config
        (
            group_id,
            auth_level,
            day_of_week,
            config_no,
            using_flag,
            start_time,
            end_time,
            transmission_interval,
            del_flg,
            register_user_id,
            register_date
        )
        SELECT
            #{rec.groupid},
            auth_level,
            day_of_week,
            config_no,
            using_flag,
            start_time,
            end_time,
            transmission_interval,
            del_flg,
            #{rec.registeruserid},
            #{rec.registerdate}
        FROM
        	send_interval_config
        WHERE group_id ='0'
  </insert>

  <insert id="insertUserAlertConfig" parameterType="com.kdc.common.entity.db.NotificationInfoEntity">
        INSERT INTO
            user_alert_config
        (
            group_id,
		    auth_level,
		    notification_auth_level,
		    location_display_flg,
		    moving_distance_display_flg,
		    battery_level_display_flg,
		    access_time_display_flg,
		    reception_status_display_flg,
		    battery_level_alert_flg,
		    battery_notification,
		    battery_popup,
		    battery_alarm_time,
		    battery_vibration_time,
		    battery_reference,
		    connection_alert_flg,
		    connection_notification,
		    connection_popup,
		    connection_alarm_time,
		    connection_vibration_time,
		    sos_alert_flg,
		    sos_notification,
		    sos_popup,
		    sos_alarm_time,
		    sos_vibration_time,
		    del_flg,
		    register_user_id,
		    register_date
        )
        SELECT
            #{rec.groupid},
            auth_level,
            notification_auth_level,
            location_display_flg,
            moving_distance_display_flg,
            battery_level_display_flg,
            access_time_display_flg,
            reception_status_display_flg,
            battery_level_alert_flg,
            battery_notification,
            battery_popup,
            battery_alarm_time,
            battery_vibration_time,
            battery_reference,
            connection_alert_flg,
            connection_notification,
            connection_popup,
            connection_alarm_time,
            connection_vibration_time,
            sos_alert_flg,
            sos_notification,
            sos_popup,
            sos_alarm_time,
            sos_vibration_time,
            del_flg,
            #{rec.registeruserid},
            #{rec.registerdate}
        FROM
        	user_alert_config
        WHERE group_id ='0'
  </insert>

  <insert id="insertConfigMasterg" parameterType="com.kdc.common.entity.db.NotificationInfoEntity">
        INSERT INTO
            config_master
        (
            group_id,
            config_id,
            config_code,
            config_name,
            config_param1,
            config_param2,
            config_param3,
            config_param4,
            config_param5,
            del_flg,
            register_user_id,
            register_date
        )
        SELECT
            #{rec.groupid},
            config_id,
            config_code,
            config_name,
            config_param1,
            config_param2,
            config_param3,
            config_param4,
            config_param5,
            del_flg,
            #{rec.registeruserid},
            #{rec.registerdate}
        FROM
        	config_master
        WHERE group_id ='0'
  </insert>
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
</mapper>
